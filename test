import json
import sys
from datetime import datetime

def send(msg: dict):
    sys.stdout.write(json.dumps(msg) + "\n")
    sys.stdout.flush()

def main():
    for line in sys.stdin:
        request = json.loads(line)

        # MCP handshake
        if request.get("type") == "handshake":
            send({"type": "handshake_ok"})
            continue

        # Tool discovery
        if request.get("type") == "tools":
            send({
                "type": "tools",
                "tools": [
                    {"name": "get_time_of_day"},
                    {"name": "get_weather", "parameters": {"location": "string"}},
                ],
            })
            continue

        # Tool invocation
        if request.get("type") == "invoke":
            name = request.get("name")
            args = request.get("arguments", {})

            if name == "get_time_of_day":
                hour = datetime.now().hour
                if 5 <= hour < 12:
                    result = "morning"
                elif 12 <= hour < 17:
                    result = "afternoon"
                elif 17 <= hour < 21:
                    result = "evening"
                else:
                    result = "night"

                send({"type": "result", "result": result})
                continue

            if name == "get_weather":
                location = args.get("location", "Bangalore")
                send({"type": "result", "result": f"Sunny in {location} ðŸŒ¤ï¸"})
                continue

            send({"type": "error", "error": "Unknown tool"})

if __name__ == "__main__":
    main()
