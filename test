from tools.time_tool import get_time_of_day
from langchain_core.prompts import ChatPromptTemplate

def run(
    self,
    messages: str | ChatMessage | list[str] | list[ChatMessage] | None = None,
    *,
    thread: AgentThread | None = None,
    **kwargs,
) -> AgentRunResponse:

    # 1️⃣ Call tool
    time_of_day = get_time_of_day()

    # 2️⃣ Build prompt using tool output
    greeting_prompt = self.greetings_prompt(
        user_input=messages,
        time_of_day=time_of_day
    )

    prompt_template = ChatPromptTemplate.from_messages([
        ("human", greeting_prompt),
    ])

    prompt_value = prompt_template.format_prompt()

    llm = model("3")
    response_message = llm.invoke(prompt_value)

    if thread is not None:
        self._notify_thread_of_new_messages(
            thread,
            messages,
            response_message.content
        )

    return AgentRunResponse(
        messages=[response_message.content]
    )
