import pandas as pd
from docx import Document
import re

# -----------------------------
# 1. Load DataFrame
# -----------------------------
df = pd.read_csv("input.csv")  # or pd.read_excel(...)

# Keep only rows where annotation exists
df = df[df['annotation'].notna()]

# Clean section names (remove numbering like "1.", "1.1")
df['section_clean'] = (
    df['section_name']
    .astype(str)
    .str.replace(r'^\d+(\.\d+)*\s*', '', regex=True)
    .str.strip()
)

# Create mapping: section -> annotation
section_to_annotation = dict(
    zip(df['section_clean'], df['annotation'])
)

# -----------------------------
# 2. Load Word Document
# -----------------------------
doc = Document("input.docx")

paragraphs = doc.paragraphs

# -----------------------------
# 3. Replace placeholders
# -----------------------------
for i, para in enumerate(paragraphs):
    heading_text = para.text.strip()

    if heading_text in section_to_annotation:
        annotation_text = section_to_annotation[heading_text]

        # Look for next paragraph (where {} or {Placeholder} exists)
        if i + 1 < len(paragraphs):
            next_para = paragraphs[i + 1]
            next_text = next_para.text.strip()

            # Explicit placeholder handling
            if next_text in ["{}", "{Placeholder}"]:
                next_para.text = annotation_text

# -----------------------------
# 4. Save Output
# -----------------------------
doc.save("output.docx")
