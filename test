from kafka import KafkaProducer
import ssl

bootstrap_servers = 'cesharedkafka3-dev.aexp.com:4492'

ssl_cafile = r'C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\Amex_Internal_Root_CA.pem'
ssl_certfile = r'C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\certificate.pem'
ssl_keyfile = r'C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\keystore.pem'
ssl_password = 'mrmg-kafka'

context = ssl.create_default_context(ssl.Purpose.SERVER_AUTH, cafile=ssl_cafile)
context.load_cert_chain(certfile=ssl_certfile, keyfile=ssl_keyfile, password=ssl_password)

producer = KafkaProducer(
    bootstrap_servers=bootstrap_servers,
    security_protocol="SSL",
    ssl_context=context,
    key_serializer=lambda k: k.encode("utf-8"),
    value_serializer=lambda v: v.encode("utf-8")
)

# Try sending a test message
producer.send("test-topic", key="test-key", value="test-message")
producer.flush()

print("âœ… Kafka test message sent.")
