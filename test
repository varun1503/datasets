from your_module import ModelDoc, ValReport
import pandas as pd

# Paths
source_path = "MyModel.docx"
template_path = "base/Business_C.docx"
mapping_path = "mapping/Business_C.csv"

# Load docs
source = ModelDoc(source_path)        # source model document
dest = ValReport(template_path)       # base validation report
mapping = pd.read_csv(mapping_path).fillna('').to_dict(orient='records')

# Iterate mapping
for i, row in enumerate(mapping):
    for s in reversed(row['sections'].split('; ')):
        if not s:
            continue
        try:
            section_title, c = source.copy_content(start=s)
            dest.paste_content(c, row['text'], str(i+1))
            dest.put_text(row['text'], f'Model Document Section: {section_title}', 'magenta')
            dest.put_text(row['text'], row['Answer'], 'yellow')   # from CSV Answer column
        except Exception as e:
            dest.put_text(row['text'], f'ERROR: {s} → {e}', 'red')

# Save result
out_file = "MyModel - Validation Report (Auto).docx"
dest.save(out_file)
print("✅ Validation Report generated:", out_file)
