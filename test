from cassandra.cluster import Cluster
from cassandra.auth import PlainTextAuthProvider

def create_ann_index_cosine(keyspace, table, vector_column='vector', host='127.0.0.1', username=None, password=None):
    # Connect to Cassandra
    auth = PlainTextAuthProvider(username, password) if username else None
    cluster = Cluster([host], auth_provider=auth) if auth else Cluster([host])
    session = cluster.connect()
    session.set_keyspace(keyspace)

    # Create the index
    index_query = f"""
    CREATE CUSTOM INDEX IF NOT EXISTS ann_index_{vector_column}
    ON {table}({vector_column})
    USING 'StorageAttachedIndex'
    WITH OPTIONS = {{ 'similarity_function': 'COSINE' }};
    """
    session.execute(index_query)

    session.shutdown()
    cluster.shutdown()
    print(f"ANN index on '{vector_column}' using COSINE similarity created for table '{table}' in keyspace '{keyspace}'.")
