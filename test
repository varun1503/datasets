import asyncio
import logging
import os
from datetime import datetime
from fastmcp import FastMCP

# --------------------------------------------------
# Logging
# --------------------------------------------------
logging.basicConfig(
    format="[%(levelname)s]: %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

# --------------------------------------------------
# MCP Server
# --------------------------------------------------
mcp = FastMCP("Weather-Time MCP Server ‚è∞üå§Ô∏è")


@mcp.tool()
def get_time_of_day():
    """
    Returns the current time of day.
    """
    hour = datetime.now().hour
    if 5 <= hour < 12:
        return "morning"
    elif 12 <= hour < 17:
        return "afternoon"
    elif 17 <= hour < 21:
        return "evening"
    return "night"


@mcp.tool()
def get_weather(city: str = "Bangalore"):
    """
    Returns mocked weather information for a city.
    """
    return f"The weather in {city} is sunny with light clouds üå§Ô∏è"


# --------------------------------------------------
# Run MCP server
# --------------------------------------------------
if __name__ == "__main__":
    port = int(os.getenv("PORT", 8006))
    logger.info(f"üöÄ MCP server started on port {port}")

    asyncio.run(
        mcp.run_async(
            transport="http",
            host="0.0.0.0",
            port=port,
        )
    )
