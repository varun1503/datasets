import re

def is_caption(text):
    return bool(re.match(r'^\s*(Figure|Fig\.?)\s*\d+[:.\s-]', text, re.IGNORECASE))

...

# Inside your image loop
image_caption = None

# Check previous and next paragraphs for possible caption
prev_para = paragraph_list[i - 1].text if i > 0 else ''
next_para = paragraph_list[i + 1].text if i < len(paragraph_list) - 1 else ''

if is_caption(prev_para):
    image_caption = prev_para.strip()
elif is_caption(next_para):
    image_caption = next_para.strip()

image_item = {
    'id': image_id,
    'type': 'image',
    'label': image_label,
    'source': file_name,
    'image_context': llm_output if llm_output else "None",
    'caption': image_caption,
    'parent_id': parent['id'] if parent else None
}
