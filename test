import asyncio
import logging
import os
from datetime import datetime
from fastmcp import FastMCP

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

mcp = FastMCP("Weather & Time MCP Server")


@mcp.tool()
def get_time_of_day():
    """Return the current time of day."""
    hour = datetime.now().hour
    if 5 <= hour < 12:
        return "morning"
    elif 12 <= hour < 17:
        return "afternoon"
    elif 17 <= hour < 21:
        return "evening"
    return "night"


@mcp.tool()
def get_weather(city: str):
    """Return weather for a city."""
    return f"The weather in {city} is sunny ðŸŒ¤ï¸"


if __name__ == "__main__":
    port = int(os.getenv("PORT", 8006))
    logger.info(f"ðŸš€ MCP server running on port {port}")
    asyncio.run(
        mcp.run_async(
            transport="http",
            host="0.0.0.0",
            port=port,
        )
    )
