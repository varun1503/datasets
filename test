from kafka import KafkaProducer
import logging

# Optional: enable debug logging
logging.basicConfig(level=logging.INFO)

def get_kafka_producer():
    producer_config = {
        "bootstrap_servers": "cesharedkafka3-dev.aexp.com:4492",
        "security_protocol": "SSL",
        "ssl_cafile": r"C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\Amex_Internal_Root_CA.pem",
        "ssl_certfile": r"C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\certificate.pem",
        "ssl_keyfile": r"C:\Users\vvaishy\Documents\hpt_rasa\mrmg_preprocess\600004454-chunking\resources\kafka\E1\keystore.pem",
        "ssl_password": "mrmg-kafka",
        "ssl_check_hostname": True,
        "key_serializer": lambda k: k.encode("utf-8"),
        "value_serializer": lambda v: v.encode("utf-8"),
    }

    return KafkaProducer(**producer_config)

def main():
    topic = "IPC1-SharedV3_600004454_chunking"
    producer = get_kafka_producer()

    test_key = "test-key"
    test_value = "Hello from local Kafka SSL producer!"

    try:
        future = producer.send(topic, key=test_key, value=test_value)
        result = future.get(timeout=10)
        print(f"✅ Successfully sent message to {topic}: {result}")
    except Exception as e:
        print(f"❌ Failed to send message: {e}")
    finally:
        producer.close()

if __name__ == "__main__":
    main()
