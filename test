import re
import unicodedata

class Preprocessing:
    def __init__(self):
        self.s3_object = S3Utils()

    def clean_paragraph_text(self, text: str) -> str:
        """
        Cleans a paragraph by:
        - Normalizing unicode (NFKC)
        - Removing newlines and extra blank lines
        - Replacing non-breaking spaces
        - Collapsing multiple spaces/tabs into one
        - Stripping leading/trailing whitespace
        """
        if not isinstance(text, str):
            return ""

        s = unicodedata.normalize("NFKC", text)

        # Normalize spaces/newlines
        s = s.replace("\r\n", " ").replace("\r", " ").replace("\n", " ")
        s = s.replace("\xa0", " ")  # non-breaking space â†’ normal space

        # Collapse multiple whitespace (spaces, tabs, etc.) into one
        s = re.sub(r"\s+", " ", s)

        # Strip leading/trailing
        s = s.strip()

        return s
